<div class="places-container">
  <h2>ğŸ“ Ajouter une Place</h2>

  <!-- Ajouter une nouvelle place -->
  <div class="form-group add-place-form">
    <input
      [(ngModel)]="newPlace.name"
      placeholder="Nom de la place"
      class="form-control"
    />
    <select
    [(ngModel)]="newPlace.category"
    class="form-select mt-2"
  >
    <option value="" disabled selected>Choisir une catÃ©gorie</option>
    <option *ngFor="let category of categories" [value]="category">
      {{ category }}
    </option>
  </select>
    <textarea
      [(ngModel)]="newPlace.description"
      placeholder="Description"
      class="form-control mt-2"
    ></textarea>
    <input
      [(ngModel)]="newPlace.address"
      placeholder="Adresse"
      class="form-control mt-2"
    />

    <select
      [(ngModel)]="newPlace.city"
      class="form-select mt-2"
      (change)="onCityChange($event)"
    >
      <option value="" disabled selected>Choisir une ville</option>
      <option *ngFor="let city of cities" [value]="city">{{ city }}</option>
    </select>

    <label for="mapInput">Lien Google Maps (iframe complet ou lien)</label>
    <textarea
      id="mapInput"
      rows="4"
      [(ngModel)]="mapInputTemp"
      (blur)="extractMapUrlFromIframe(mapInputTemp)"
      placeholder="Collez ici le code iframe de Google Maps ou directement le lien"
    >
    </textarea>

    <input
      [(ngModel)]="newPlace.phoneNumber"
      placeholder="NumÃ©ro de tÃ©lÃ©phone"
      class="form-control mt-2"
    />

    <h5 class="mt-4">ğŸ• Ajouter un horaire d'ouverture</h5>

    <div class="row g-2 align-items-center">
      <!-- Jour -->
      <div class="col-md-3">
        <select class="form-select" [(ngModel)]="selectedDay">
          <option *ngFor="let day of days" [value]="day">{{ day }}</option>
        </select>
      </div>

      <!-- Heure dÃ©but -->
      <div class="col-md-3">
        <select class="form-select" [(ngModel)]="openingHourStart">
          <option *ngFor="let hour of hours" [value]="hour">{{ hour }}</option>
        </select>
      </div>

      <!-- Heure fin -->
      <div class="col-md-3">
        <select class="form-select" [(ngModel)]="openingHourEnd">
          <option *ngFor="let hour of hours" [value]="hour">{{ hour }}</option>
        </select>
      </div>

      <!-- Bouton Ajouter -->
      <div class="col-md-3">
        <button
          class="btn btn-outline-primary w-100"
          (click)="addOpeningHour()"
        >
          Ajouter
        </button>
      </div>
    </div>

    <!-- Affichage des horaires enregistrÃ©s -->
    <div class="mt-3" *ngIf="getOpeningDays().length > 0">
      <strong>Horaires enregistrÃ©s :</strong>
      <ul class="list-group mt-2">
        <li
          class="list-group-item d-flex justify-content-between align-items-center"
          *ngFor="let day of getOpeningDays()"
        >
          {{ day }} : {{ newPlace.openingHours[day] }}
          <button
            class="btn btn-sm btn-danger"
            (click)="removeOpeningHour(day)"
          >
            âŒ
          </button>
        </li>
      </ul>
    </div>

    <h5 class="mt-3">ğŸ·ï¸ Rechercher un tag</h5>
    <input
      type="text"
      class="form-control"
      placeholder="Rechercher un tag..."
      [(ngModel)]="tagSearch"
      (input)="filterTags()"
    />

    <ul class="list-group mt-2" *ngIf="filteredTags.length > 0">
      <li
        class="list-group-item list-group-item-action"
        *ngFor="let tag of filteredTags"
        (click)="addTag(tag.libelle)"
        style="cursor: pointer"
      >
        {{ tag.libelle }}
      </li>
    </ul>

    <div class="mt-3" *ngIf="selectedTags.length > 0">
      <strong>Tags sÃ©lectionnÃ©s :</strong>
      <div class="d-flex flex-wrap gap-2 mt-2">
        <span
          *ngFor="let tag of selectedTags"
          class="badge bg-primary p-2"
          style="cursor: pointer"
        >
          {{ tag }}
          <span class="ms-1" (click)="removeTag(tag)">âŒ</span>
        </span>
      </div>
    </div>

    <label class="mt-3">ğŸ–¼ï¸ Images :</label>
    <input
      type="file"
      (change)="onImageSelected($event)"
      class="form-control mt-2"
      multiple
    />

    <!-- AperÃ§u des images sÃ©lectionnÃ©es -->
    <div class="row mt-3" *ngIf="newPlace.images && newPlace.images.length > 0">
      <strong class="col-12">AperÃ§u des images :</strong>
      <div
        class="col-md-3 mb-3"
        *ngFor="let img of newPlace.images; let i = index"
      >
        <div class="position-relative">
          <img
            [src]="img"
            alt="Image"
            class="img-thumbnail w-100"
            style="height: 150px; object-fit: cover"
          />
          <button
            type="button"
            class="btn btn-sm btn-danger position-absolute top-0 end-0 m-1"
            (click)="removeImage(i)"
          >
            âŒ
          </button>
        </div>
      </div>
    </div>

    <button (click)="addPlace()" class="btn-add-place">Ajouter</button>
  </div>
</div>
