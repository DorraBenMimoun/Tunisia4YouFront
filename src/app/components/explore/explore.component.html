<!-- explore.component.html -->
<div
  class="container-fluid explore-container p-5"
  *ngIf="places && places.length > 0"
>
  <!-- Search and Filters -->
  <div class="row mb-4 g-3">
    <!-- Search Bar -->
    <div class="col-md-8">
      <div class="search-bar input-group">
        <span class="input-group-text bg-white border-end-0">
          <i class="fas fa-search"></i>
        </span>
        <input
          type="text"
          class="form-control border-start-0"
          placeholder="Rechercher un lieu, une cat√©gorie, une ville..."
          aria-label="Recherche"
          [(ngModel)]="searchTerm"
          (input)="searchPlaces()"
        />
      </div>
    </div>

    <!-- Filter Dropdowns -->
    <div class="col-md-4">
      <div class="d-flex gap-2">
        <select
          class="form-select"
          [(ngModel)]="selectedCategory"
          (ngModelChange)="applyFilters()"
          aria-label="Filtrer par cat√©gorie"
        >
          <option value="">Toutes cat√©gories</option>
          <option *ngFor="let category of categories" [value]="category">
            {{ category }}
          </option>
          <option *ngIf="categories.length === 0" disabled>
            Aucune cat√©gorie
          </option>
        </select>

        <select
          class="form-select"
          [(ngModel)]="selectedCity"
          (ngModelChange)="applyFilters()"
          aria-label="Filtrer par ville"
        >
          <option value="">Toutes villes</option>
          <option *ngFor="let city of cities" [value]="city">{{ city }}</option>
          <option *ngIf="cities.length === 0" disabled>Aucune ville</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Tags Filter -->
  <div class="mb-4">
    <div class="d-flex flex-wrap gap-2">
      <ng-container *ngIf="popularTags.length > 0; else noTags">
        <span
          *ngFor="let tag of popularTags"
          class="badge rounded-pill tag-pill px-3 py-2"
          [class.bg-primary]="selectedTags.includes(tag)"
          [class.text-white]="selectedTags.includes(tag)"
          [class.bg-light]="!selectedTags.includes(tag)"
          style="cursor: pointer; transition: all 0.3s"
          (click)="toggleTag(tag)"
        >
          #{{ tag }}
        </span>
      </ng-container>
      <ng-template #noTags>
        <span class="text-muted">Aucun tag populaire</span>
      </ng-template>
    </div>
  </div>

  <!-- Places Grid -->
  <div class="grid gap-6 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3">
    <a
      *ngFor="let place of filteredPlaces"
      [routerLink]="['/place', place.id]"
      class="block bg-white shadow-md rounded-2xl overflow-hidden hover:shadow-xl transition-shadow duration-300 relative"
    >
      <div class="relative">
        <img
          [src]="
            place.images?.length
              ? 'http://localhost:5066' + place.images[0]
              : 'https://media.istockphoto.com/id/1409329028/vector/no-picture-available-placeholder-thumbnail-icon-illustration-design.jpg?s=612x612&w=0&k=20&c=_zOuJu755g2eEUioiOUdz_mHKJQJn-tDgIAhQzyeKUQ='
          "
          alt="{{ place.name }}"
          class="w-full h-48 object-cover"
        />
        <div class="absolute top-2 right-2 z-10">
          <button
            (click)="
              $event.stopPropagation();
              $event.preventDefault();
              openAddToListModal(place.id)
            "
            class="bg-white text-green-600 hover:text-green-800 border border-green-500 rounded-full p-2 shadow hover:shadow-md transition"
          >
            <i class="fas fa-plus"></i>
          </button>
        </div>
      </div>
      <div class="p-4">
        <h2 class="text-xl font-semibold text-gray-800 flex items-center gap-2">
          <i class="fas fa-map-marker-alt text-red-500"></i> {{ place.name }}
        </h2>
        <p class="text-sm text-gray-600 mt-1 mb-3 line-clamp-3">
          {{ place.description }}
        </p>

        <div class="text-sm text-gray-500 mb-2">
          <div class="d-flex flex-wrap gap-1">
            <span
              *ngFor="let tag of place.tags"
              class="badge bg-light text-dark"
            >
              #{{ tag }}
            </span>
          </div>
        </div>

        <div class="flex justify-between items-center">
          <span class="text-xs text-gray-400">üìç {{ place.address }}</span>
        </div>
      </div>
    </a>
  </div>
  <!-- Empty State -->
  <div *ngIf="filteredPlaces.length === 0" class="text-center py-5">
    <h4>Aucun lieu ne correspond √† votre recherche</h4>
    <button class="btn btn-link" (click)="resetFilters()">
      R√©initialiser les filtres
    </button>
  </div>
</div>

<app-add-to-lists />
