<div class="p-8 bg-white rounded-3xl shadow-lg max-w-lg mx-auto mt-12">
  <h2 class="text-3xl font-semibold text-gray-900 mb-8 text-center">
    Laisser un commentaire
  </h2>

  <form (ngSubmit)="submitReview()" class="space-y-6">
    <!-- Commentaire -->
    <div>
      <label
        class="block text-sm font-medium text-gray-700 mb-2"
        for="commentaire"
        >Commentaire</label
      >
      <textarea
        id="commentaire"
        [(ngModel)]="commentaire"
        name="commentaire"
        rows="5"
        placeholder="Exprimez-vous..."
        class="w-full p-4 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 transition ease-in-out"
        required
      ></textarea>
    </div>

    <!-- Note -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-2">Note</label>
      <div class="flex justify-center space-x-2">
        <ng-container *ngFor="let star of [1, 2, 3, 4, 5]">
          <button
            type="button"
            (click)="note = star"
            (mouseenter)="setHoveredNote(star)"
            (mouseleave)="clearHoveredNote()"
            class="text-3xl focus:outline-none transition transform hover:scale-125"
          >
            <span
              [ngClass]="
                hoveredNote >= star || (!hoveredNote && note >= star)
                  ? 'text-yellow-500'
                  : 'text-gray-400'
              "
            >
              <i class="fa fa-star"></i>
            </span>
          </button>
        </ng-container>
      </div>
    </div>

    <button
      type="submit"
      class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-xl shadow-lg transition transform hover:scale-105"
    >
      Envoyer votre avis
    </button>
  </form>

  <!-- Section des commentaires -->
  <div class="mt-12 space-y-6">
    <h3 class="text-xl font-bold text-gray-800 mb-6 text-center">
      Avis existants
    </h3>

    <div
      *ngFor="let review of reviews"
      class="flex space-x-4 p-5 bg-gray-50 rounded-xl shadow-md items-start relative"
    >
      <div class="flex-1">
        <div class="flex justify-between items-center mb-3">
          <div class="flex items-center space-x-3">
            <img
              [src]="
                review.userAvatar ||
                'https://ui-avatars.com/api/?name=' +
                  (review.username || 'Utilisateur')
              "
              alt="Avatar"
              class="w-14 h-14 rounded-full object-cover"
            />
            <p class="font-semibold text-gray-800">{{ review.username }}</p>
          </div>

          <p class="text-sm text-gray-500">
            {{ review.createdAt | date : "dd MMM yyyy" }}
          </p>
        </div>

        <p class="text-gray-700 mb-3">{{ review.commentaire }}</p>

        <div class="flex items-center space-x-2">
          <ng-container *ngFor="let star of [].constructor(review.note)">
            <span class="text-2xl text-yellow-400">â­</span>
          </ng-container>
        </div>
      </div>

      <!-- Actions de suppression et signalement -->
      <div class="absolute bottom-0 right-0 m-3 flex space-x-2">
        <button
          (click)="deleteReview(review.id)"
          class="text-red-500 hover:text-red-700 text-sm font-semibold"
        >
          ğŸ—‘ï¸
        </button>
        <button
          (click)="openReportModal(review.id, review.userId)"
          class="text-red-500 hover:text-red-700 text-sm font-semibold"
        >
          ğŸ‘
        </button>
      </div>
    </div>
  </div>

  <!-- Modale de signalement -->
  <div
    *ngIf="isModalOpen"
    class="fixed inset-0 bg-gray-500 bg-opacity-50 flex justify-center items-center z-50"
  >
    <div class="bg-white p-6 rounded-lg shadow-xl w-96">
      <h3 class="text-lg font-semibold mb-4 text-gray-800">
        Signaler un commentaire
      </h3>
      <form (ngSubmit)="submitReport()">
        <div class="mb-6">
          <label for="reason" class="block text-sm font-medium text-gray-700"
            >Raison du signalement</label
          >
          <select
            id="reason"
            [(ngModel)]="reason"
            name="reason"
            class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition"
          >
            <option value="Inappropriate content">Contenu inappropriÃ©</option>
            <option value="Spam">Spam</option>
            <option value="Harassment">HarcÃ¨lement</option>
          </select>
        </div>

        <div class="flex justify-end space-x-3">
          <button
            type="button"
            (click)="closeReportModal()"
            class="text-gray-600 hover:text-gray-800 text-sm font-semibold"
          >
            Annuler
          </button>
          <button
            type="submit"
            class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg"
          >
            Soumettre le signalement
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
